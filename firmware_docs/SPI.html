<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" href="faviconMRE2.png" type="image/x-icon" />
<title>MR-E-2: SPI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://www.optotune.com/" target="_blank"><img alt="Logo" src="optotune_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MR-E-2
   &#160;<span id="projectnumber">138-161-00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SPI</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>SPI system ID: <b>0x30</b> </p>
<h1><a class="anchor" id="spi_interface"></a>
Interface</h1>
<p>MR-E-2 driver has a four wire SPI slave interface. The SPI Mode 1 (CPOL = 0, CPHA = 1) is used. The data is applied to the interface on the positive edge of the clock and sampled at the negative edge. Additionally, MR-E-2 provides a SPI data not ready signal for accurate time synchronization with the master.</p>
<p>The table below illustrates the pinout connection of the SPI interface to the corresponding MR-E-2 I/O connector.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Signal   </th><th class="markdownTableHeadNone">Pin on MR-E-2 I/O Connector   </th><th class="markdownTableHeadNone">IO Direction    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPI_MOSI   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">In    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPI_CLK   </td><td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">In    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPI_NSS   </td><td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">In    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPI_MISO   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Out    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GND   </td><td class="markdownTableBodyNone">9   </td><td class="markdownTableBodyNone">-    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPI_DATA_NRDY   </td><td class="markdownTableBodyNone">10   </td><td class="markdownTableBodyNone">Out   </td></tr>
</table>
<h2><a class="anchor" id="spi_framing"></a>
Framing</h2>
<p>Each transfer consists of 14 bytes with 8 bits each (or 7 words with 16 bits each). A negative edge on the NSS line, marks the beginning of a new frame. Frame ends with a positive edge on the NSS line. </p><dl class="section note"><dt>Note</dt><dd>The data are transmitted with MSB first.</dd></dl>
<h2><a class="anchor" id="spi_timing"></a>
Timing and synchronization</h2>
<ul>
<li>The interface is designed to work up to 4 MHz clock frequency.</li>
<li>The time required to drive the MISO line after the positive edge of the clock is about 35 ns.</li>
<li>To ensure a proper operation of the interface, the time between the negative edge of the NSS signal and any edge on the clock signal must be at least 20 ns.</li>
</ul>
<p>In order to achieve accurate time synchronization between the slave and the master the SPI_DATA_NRDY signal is provided by the MR-E-2 driver. When MR-E-2 starts receiving a SPI frame, the SPI_DATA_NRDY signal is driven high, signaling that the receiving frame is started being processed. Once the frame is processed and the data requested are ready for transmission, the SPI_DATA_NRDY is driven low. Master should not send a new SPI frame while the SPI_DATA_NRDY is high. MR-E-2 driver updates its registers at a frequency of 10kHz. Frames received at a higher frequency cannot be processed.</p>
<h2><a class="anchor" id="spi_data_structure"></a>
Data Structure</h2>
<p>The 14 bytes (7 words) for each data transfer (MISO and MOSI) are explain in the following subsections. The master can write and read registers in order to control the driver. The master can write up to two registers and read up to three registers with one frame transaction. Regardless of a read or write request, the last eight bytes of the SPI data frame slave response is reserved for reading back registers.</p>
<h2><a class="anchor" id="spi_mosi"></a>
Master Out Slave In</h2>
<p>A data frame of a <b>write request</b> is shown below. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Word   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Write flag (0x0001)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">'System ID1' + 'Register ID1' to perform write    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">'System ID2' + 'Register ID2' to perform write    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Data to write in address 'System ID1' + 'Register ID1'    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5-6   </td><td class="markdownTableBodyNone">Data to write in address 'System ID2' + 'Register ID2'   </td></tr>
</table>
<p>A data frame of a <b>read request</b> is shown below. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Word   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Read flag (0x0000)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">'System ID' + 'Register ID' to perform read    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2-6   </td><td class="markdownTableBodyNone">0   </td></tr>
</table>
<h2><a class="anchor" id="spi_miso"></a>
Master In Slave Out</h2>
<p>A data frame of a <b>response to a write request</b> is shown below. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Word   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Write flag (0x0001)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">'System ID1' + 'Register ID1', by write fail: 0x0000    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">'System ID2' + 'Register ID2', by write fail: 0x0000    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Read back data according to SPI read pointer register 0, by read back fail: 0x7cf0bdc2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5-6   </td><td class="markdownTableBodyNone">Read back data according to SPI read pointer register 1, by read back fail: 0x7cf0bdc2   </td></tr>
</table>
<p>A data frame of a <b>response to a read request</b> is shown below. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Word   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Read flag (0x0000)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1-2   </td><td class="markdownTableBodyNone">Read back data of address 'System ID' + 'Register ID' asked from previous read request, by read back fail: 0x7cf0bdc2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Read back data according to SPI read pointer register 0, by read back fail: 0x7cf0bdc2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5-6   </td><td class="markdownTableBodyNone">Read back data according to SPI read pointer register 1, by read back fail: 0x7cf0bdc2   </td></tr>
</table>
<h3>Register map:</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Address   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Default Value   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Access    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x3000   </td><td class="markdownTableBodyNone">SPI read pointer 0   </td><td class="markdownTableBodyNone">0x2302   </td><td class="markdownTableBodyNone">The address of the register that will be used to update the read back bytes 4-7 in the slave response   </td><td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">read write    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x3001   </td><td class="markdownTableBodyNone">SPI read pointer 1   </td><td class="markdownTableBodyNone">0x2303   </td><td class="markdownTableBodyNone">The address of the register that will be used to update the read back bytes 8-11 in the slave response   </td><td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">read write    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x3002   </td><td class="markdownTableBodyNone">System tick   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Register value is incremented by one at the controller frequency (10kHz)   </td><td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">read only   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.optotune.com/" target="_blank">Optotune. All rights reserved. 
</a>
</small></address>
</body>
</html>
